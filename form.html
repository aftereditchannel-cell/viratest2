<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Onboarding</title>

  <style>
    :root{
      --primary:#7c3aed;
      --bg:#0f0f14;
      --card:#171720;
      --border:#2a2a35;
      --text:#fff;
      --muted:#9ca3af;
    }
    *{box-sizing:border-box;font-family:sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}
    .app{min-height:100vh;display:flex;flex-direction:column}
    header{padding:20px}
    .progress{height:4px;background:var(--border);border-radius:999px;overflow:hidden}
    .progress span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#7c3aed,#a78bfa);transition:.3s}
    main{flex:1;padding:20px}
    h2{margin:0 0 6px}
    p{margin:0 0 20px;color:var(--muted);font-size:14px}
    .field{margin-bottom:16px}
    label{display:block;margin-bottom:6px;font-size:14px}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:var(--card);color:var(--text)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .option{padding:14px;border-radius:14px;border:1px solid var(--border);background:var(--card);color:var(--text);cursor:pointer}
    .option.active{border-color:var(--primary);background:rgba(124,58,237,.15);color:var(--primary)}
    footer{padding:16px;border-top:1px solid var(--border)}
    .cta{width:100%;padding:16px;border-radius:16px;border:none;background:linear-gradient(135deg,#7c3aed,#a78bfa);color:white;font-size:16px;font-weight:bold;cursor:pointer;opacity:.4}
    .cta.enabled{opacity:1}
    .hidden{display:none}
  </style>
  <link rel="stylesheet" href="form.css">
</head>

<body>
<div class="app">

<header>
  <div class="progress"><span id="progress"></span></div>
</header>

<main>

<section class="step" data-step="0">
  <h2>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø¯Ù†ÛŒ</h2>
  <p>Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±</p>

  <div class="field">
    <label>Ù‚Ø¯</label>
    <input id="height" type="number">
  </div>

  <div class="field">
    <label>ÙˆØ²Ù†</label>
    <input id="weight" type="number">
  </div>

  <div class="field">
    <label>Ø³Ù† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
    <input id="age" type="number">
  </div>

  <div class="field">
    <label>ÙØ±Ù… Ø¨Ø¯Ù†</label>
    <div class="grid" id="bodyShapes"></div>
  </div>
</section>

<section class="step hidden" data-step="1">
  <h2>Ù‡ÙˆÛŒØª Ùˆ Ø³Ø¨Ú©</h2>
  <p>Ú†ÛŒØ²ÛŒ Ú©Ù‡ Ø¨Ù‡Øª Ù…ÛŒØ§Ø¯</p>

  <div class="field">
    <label>Ø¬Ù†Ø³ÛŒØª</label>
    <div class="grid" id="genders"></div>
  </div>

  <div class="field">
    <label>Ø³Ø¨Ú©â€ŒÙ‡Ø§</label>
    <div class="grid" id="styles"></div>
  </div>
</section>

<section class="step hidden" data-step="2">
  <h2>Ø§Ù‡Ø¯Ø§Ù</h2>
  <p>Ù‚Ø±Ø§Ø±Ù‡ Ú©Ø¬Ø§ Ú©Ù…Ú©Øª Ú©Ù†ÛŒÙ…ØŸ</p>
  <div class="grid" id="goals"></div>
</section>

</main>

<footer>
  <button id="nextBtn" class="cta">Ø¨Ø¹Ø¯ÛŒ</button>
</footer>

</div>

<script>
const STORAGE_KEY="onboardingData";
const DONE_KEY="vira_form_done"; // Ú©Ù„ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§ auth.js Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ

// Ø§Ú¯Ø± ÙØ±Ù… Ù‚Ø¨Ù„Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ â†’ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ home
if(localStorage.getItem(DONE_KEY)==="true"){
  window.location.href="home.html";
}

const saved=JSON.parse(localStorage.getItem(STORAGE_KEY));
const data=saved || {height:"",weight:"",age:"",bodyShape:"",gender:"",styles:[],goals:[]};

function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data))}

const bodyShapes=[["slim","Ù„Ø§ØºØ±"],["athletic","ÙˆØ±Ø²Ø´Ú©Ø§Ø±ÛŒ"],["average","Ù…ØªÙˆØ³Ø·"],["plus","Ù¾Ù„Ø§Ø³â€ŒØ³Ø§ÛŒØ²"]];
const genders=[["male","Ù…Ø±Ø¯"],["female","Ø²Ù†"],["non","ØºÛŒØ±Ø¯ÙˆØ¯ÙˆÛŒÛŒ"],["none","Ù†Ù…ÛŒâ€ŒÚ¯Ù…"]];
const styles=[["minimal","âœ¨ Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„"],["street","ğŸ”¥ Ø®ÛŒØ§Ø¨Ø§Ù†ÛŒ"],["formal","ğŸ‘” Ø±Ø³Ù…ÛŒ"],["casual","ğŸ˜ Ú©Ú˜ÙˆØ§Ù„"],["sport","ğŸƒ Ø§Ø³Ù¾Ø±Øª"],["luxury","ğŸ’ Ù„Ø§Ú©Ú†Ø±ÛŒ"],["exp","ğŸ¨ ØªØ¬Ø±Ø¨ÛŒ"]];
const goals=[["daily","â˜€ï¸ Ø±ÙˆØ²Ø§Ù†Ù‡"],["party","ğŸ‰ Ù…Ù‡Ù…Ø§Ù†ÛŒ"],["date","ğŸ’• Ù‚Ø±Ø§Ø±"],["show","ğŸ’ƒ ÙØ´Ù†â€ŒØ´Ùˆ"],["closet","ğŸ‘š Ú©Ù…Ø¯"],["ai","ğŸ¤– Ø§Ø³ØªØ§ÛŒÙ„ÛŒØ³Øª"]];

let step=0;
const steps=document.querySelectorAll(".step");
const progress=document.getElementById("progress");
const nextBtn=document.getElementById("nextBtn");

function render(list,el,key,multi=false){
  list.forEach(([val,label])=>{
    const btn=document.createElement("button");
    btn.className="option";
    btn.innerText=label;
    if(multi && data[key].includes(val) || data[key]===val) btn.classList.add("active");
    btn.onclick=()=>{
      if(multi){
        data[key]=data[key].includes(val)?data[key].filter(v=>v!==val):[...data[key],val];
        btn.classList.toggle("active");
      }else{
        data[key]=val;
        [...el.children].forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
      }
      save();validate();
    };
    el.appendChild(btn);
  });
}

render(bodyShapes,document.getElementById("bodyShapes"),"bodyShape");
render(genders,document.getElementById("genders"),"gender");
render(styles,document.getElementById("styles"),"styles",true);
render(goals,document.getElementById("goals"),"goals",true);

["height","weight","age"].forEach(id=>{
  const el=document.getElementById(id);
  el.value=data[id];
  el.oninput=e=>{data[id]=e.target.value;save();validate()};
});

function validate(){
  let ok=false;
  if(step===0) ok=data.height&&data.weight&&data.bodyShape;
  if(step===1) ok=data.gender&&data.styles.length;
  if(step===2) ok=data.goals.length;
  nextBtn.classList.toggle("enabled",ok);

  // Ø§ÙÚ©Øª bounce Ú©ÙˆØªØ§Ù‡ ÙˆÙ‚ØªÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯
  if(ok){
    nextBtn.animate([{ transform: 'scale(0.95)' },{ transform: 'scale(1)' }], { duration: 150, easing: 'ease-out' });
  }
}

function updateUI(){
  steps.forEach(s=>s.classList.add("hidden"));
  steps[step].classList.remove("hidden");
  progress.style.width=((step+1)/3*100)+"%";
  nextBtn.innerText=step===2?"Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ… ğŸš€":"Ø¨Ø¹Ø¯ÛŒ";
  validate();
}

nextBtn.onclick=()=>{
  if(!nextBtn.classList.contains("enabled")) return;
  if(step<2){step++;updateUI();}
  else{
    localStorage.setItem(DONE_KEY,"true"); // Ø¹Ù„Ø§Ù…Øª ØªÚ©Ù…ÛŒÙ„ ÙØ±Ù…
    save();
    alert("Ø¢Ù†â€ŒØ¨ÙˆØ±Ø¯ÛŒÙ†Ú¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ ğŸš€");
    window.location.href="home.html";
  }
};

updateUI();
</script>
<script src="form.js" defer></script>
</body>
</html>
